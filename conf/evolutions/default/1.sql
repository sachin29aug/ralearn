-- Created by Ebean DDL
-- To stop Ebean DDL generation, remove this comment (both lines) and start using Evolutions

-- !Ups

-- apply changes
create table author (
  id                            bigint generated by default as identity not null,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  name                          varchar(255),
  bio                           varchar(255),
  gr_url                        varchar(255),
  constraint uq_author_gr_url unique (gr_url),
  constraint pk_author primary key (id)
);

create table book (
  id                            bigint generated by default as identity not null,
  rating_count                  integer,
  category_id                   bigint,
  author_id                     bigint,
  gl_book_id                    bigint,
  cpt_book_id                   bigint,
  ol_book_id                    bigint,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  rating                        decimal(3,2),
  title                         varchar(255),
  published                     varchar(255),
  gr_url                        varchar(500),
  constraint uq_book_gl_book_id unique (gl_book_id),
  constraint uq_book_cpt_book_id unique (cpt_book_id),
  constraint uq_book_ol_book_id unique (ol_book_id),
  constraint uq_book_title_author unique (title,author),
  constraint pk_book primary key (id)
);

create table book_category (
  id                            bigint generated by default as identity not null,
  book_id                       bigint not null,
  category_id                   bigint not null,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  constraint pk_book_category primary key (id)
);

create table cpt_book (
  id                            bigint generated by default as identity not null,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  headline                      varchar(255),
  teaser                        varchar(255),
  description                   text,
  theme_concept                 varchar(255),
  key_takeaways                 varchar(255),
  actionable_ideas              varchar(255),
  audience                      varchar(255),
  style_tone                    varchar(255),
  usp                           varchar(255),
  topics                        varchar(255),
  setting                       varchar(255),
  constraint pk_cpt_book primary key (id)
);

create table category (
  id                            bigint generated by default as identity not null,
  parent_id                     bigint,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  title                         varchar(255),
  url                           varchar(255),
  fa_icon_class                 varchar(255),
  constraint pk_category primary key (id)
);

create table gb_book (
  id                            bigint generated by default as identity not null,
  average_rating                float not null,
  ratings_count                 integer not null,
  page_count                    integer not null,
  printed_page_count            integer not null,
  is_ebook                      boolean default false not null,
  pdf_is_available              boolean default false not null,
  epub_is_available             boolean default false not null,
  reading_mode_text             boolean default false not null,
  reading_mode_image            boolean default false not null,
  contains_epub_bubbles         boolean default false not null,
  contains_image_bubbles        boolean default false not null,
  embeddable                    boolean default false not null,
  public_domain                 boolean default false not null,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  gb_id                         varchar(255),
  etag                          varchar(255),
  content_version               varchar(255),
  title                         varchar(255),
  sub_title                     varchar(255),
  authors                       varchar(255),
  main_category                 varchar(255),
  categories                    varchar(500),
  description                   text,
  maturity_rating               varchar(255),
  self_link                     varchar(500),
  preview_link                  varchar(500),
  thumbnail_url                 varchar(500),
  small_thumbnail_url           varchar(500),
  small_url                     varchar(500),
  medium_url                    varchar(500),
  large_url                     varchar(500),
  extra_large_url               varchar(500),
  info_link                     varchar(500),
  buy_link                      varchar(500),
  canonical_volume_link         varchar(500),
  isbn10                        varchar(255),
  isbn13                        varchar(255),
  publisher                     varchar(255),
  published_date                varchar(255),
  language                      varchar(255),
  epub_acs_token_link           varchar(500),
  sale_country                  varchar(255),
  saleability                   varchar(255),
  viewability                   varchar(255),
  access_view_status            varchar(255),
  constraint pk_gb_book primary key (id)
);

create table ol_author (
  id                            bigint generated by default as identity not null,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  author_key                    varchar(255),
  name                          varchar(255),
  bio                           text,
  photo_id                      varchar(255),
  constraint pk_ol_author primary key (id)
);

create table ol_book (
  id                            bigint generated by default as identity not null,
  rating                        float,
  rating_count                  integer,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  work_key                      varchar(255),
  title                         varchar(255),
  cover_id                      varchar(255),
  description                   text,
  author_key                    varchar(255),
  author                        varchar(255),
  author_description            varchar(255),
  subjects                      varchar(255),
  isbn13                        varchar(255),
  constraint pk_ol_book primary key (id)
);

create table quote (
  id                            bigint generated by default as identity not null,
  author_id                     bigint,
  book_id                       bigint,
  likes_count                   integer,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  text                          text,
  author_name                   varchar(255),
  tags                          text,
  source                        varchar(6),
  constraint ck_quote_source check ( source in ('KAGGLE','GR','CPT')),
  constraint pk_quote primary key (id)
);

create table user_table (
  id                            bigint generated by default as identity not null,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  first_name                    varchar(255),
  last_name                     varchar(255),
  email                         varchar(255),
  password                      varchar(255),
  constraint pk_user_table primary key (id)
);

create table user_book (
  id                            bigint generated by default as identity not null,
  user_id                       bigint,
  book_id                       bigint,
  category_id                   bigint,
  assigned                      timestamptz,
  last_accessed                 timestamptz,
  favorite                      boolean,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  constraint pk_user_book primary key (id)
);

create table user_category (
  id                            bigint generated by default as identity not null,
  user_id                       bigint,
  category_id                   bigint,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  constraint pk_user_category primary key (id)
);

create table user_feedback (
  id                            bigint generated by default as identity not null,
  user_id                       bigint,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  feedback                      text,
  constraint pk_user_feedback primary key (id)
);

create table user_rating (
  id                            bigint generated by default as identity not null,
  user_id                       bigint,
  book_id                       bigint,
  rating                        integer,
  created                       timestamptz not null,
  updated                       timestamptz not null,
  text                          text,
  constraint pk_user_rating primary key (id)
);

-- foreign keys and indices
create index ix_book_category_id on book (category_id);
alter table book add constraint fk_book_category_id foreign key (category_id) references category (id) on delete restrict on update restrict;

create index ix_book_author_id on book (author_id);
alter table book add constraint fk_book_author_id foreign key (author_id) references author (id) on delete restrict on update restrict;

alter table book add constraint fk_book_gl_book_id foreign key (gl_book_id) references gb_book (id) on delete restrict on update restrict;

alter table book add constraint fk_book_cpt_book_id foreign key (cpt_book_id) references cpt_book (id) on delete restrict on update restrict;

alter table book add constraint fk_book_ol_book_id foreign key (ol_book_id) references ol_book (id) on delete restrict on update restrict;

create index ix_book_category_book_id on book_category (book_id);
alter table book_category add constraint fk_book_category_book_id foreign key (book_id) references book (id) on delete restrict on update restrict;

create index ix_book_category_category_id on book_category (category_id);
alter table book_category add constraint fk_book_category_category_id foreign key (category_id) references category (id) on delete restrict on update restrict;

create index ix_category_parent_id on category (parent_id);
alter table category add constraint fk_category_parent_id foreign key (parent_id) references category (id) on delete restrict on update restrict;

create index ix_quote_author_id on quote (author_id);
alter table quote add constraint fk_quote_author_id foreign key (author_id) references author (id) on delete restrict on update restrict;

create index ix_quote_book_id on quote (book_id);
alter table quote add constraint fk_quote_book_id foreign key (book_id) references book (id) on delete restrict on update restrict;

create index ix_user_book_user_id on user_book (user_id);
alter table user_book add constraint fk_user_book_user_id foreign key (user_id) references user_table (id) on delete restrict on update restrict;

create index ix_user_book_book_id on user_book (book_id);
alter table user_book add constraint fk_user_book_book_id foreign key (book_id) references book (id) on delete restrict on update restrict;

create index ix_user_book_category_id on user_book (category_id);
alter table user_book add constraint fk_user_book_category_id foreign key (category_id) references category (id) on delete restrict on update restrict;

create index ix_user_category_user_id on user_category (user_id);
alter table user_category add constraint fk_user_category_user_id foreign key (user_id) references user_table (id) on delete restrict on update restrict;

create index ix_user_category_category_id on user_category (category_id);
alter table user_category add constraint fk_user_category_category_id foreign key (category_id) references category (id) on delete restrict on update restrict;

create index ix_user_feedback_user_id on user_feedback (user_id);
alter table user_feedback add constraint fk_user_feedback_user_id foreign key (user_id) references user_table (id) on delete restrict on update restrict;

create index ix_user_rating_user_id on user_rating (user_id);
alter table user_rating add constraint fk_user_rating_user_id foreign key (user_id) references user_table (id) on delete restrict on update restrict;

create index ix_user_rating_book_id on user_rating (book_id);
alter table user_rating add constraint fk_user_rating_book_id foreign key (book_id) references book (id) on delete restrict on update restrict;


-- !Downs

-- drop all foreign keys
alter table if exists book drop constraint if exists fk_book_category_id;
drop index if exists ix_book_category_id;

alter table if exists book drop constraint if exists fk_book_author_id;
drop index if exists ix_book_author_id;

alter table if exists book drop constraint if exists fk_book_gl_book_id;

alter table if exists book drop constraint if exists fk_book_cpt_book_id;

alter table if exists book drop constraint if exists fk_book_ol_book_id;

alter table if exists book_category drop constraint if exists fk_book_category_book_id;
drop index if exists ix_book_category_book_id;

alter table if exists book_category drop constraint if exists fk_book_category_category_id;
drop index if exists ix_book_category_category_id;

alter table if exists category drop constraint if exists fk_category_parent_id;
drop index if exists ix_category_parent_id;

alter table if exists quote drop constraint if exists fk_quote_author_id;
drop index if exists ix_quote_author_id;

alter table if exists quote drop constraint if exists fk_quote_book_id;
drop index if exists ix_quote_book_id;

alter table if exists user_book drop constraint if exists fk_user_book_user_id;
drop index if exists ix_user_book_user_id;

alter table if exists user_book drop constraint if exists fk_user_book_book_id;
drop index if exists ix_user_book_book_id;

alter table if exists user_book drop constraint if exists fk_user_book_category_id;
drop index if exists ix_user_book_category_id;

alter table if exists user_category drop constraint if exists fk_user_category_user_id;
drop index if exists ix_user_category_user_id;

alter table if exists user_category drop constraint if exists fk_user_category_category_id;
drop index if exists ix_user_category_category_id;

alter table if exists user_feedback drop constraint if exists fk_user_feedback_user_id;
drop index if exists ix_user_feedback_user_id;

alter table if exists user_rating drop constraint if exists fk_user_rating_user_id;
drop index if exists ix_user_rating_user_id;

alter table if exists user_rating drop constraint if exists fk_user_rating_book_id;
drop index if exists ix_user_rating_book_id;

-- drop all
drop table if exists author cascade;

drop table if exists book cascade;

drop table if exists book_category cascade;

drop table if exists cpt_book cascade;

drop table if exists category cascade;

drop table if exists gb_book cascade;

drop table if exists ol_author cascade;

drop table if exists ol_book cascade;

drop table if exists quote cascade;

drop table if exists user_table cascade;

drop table if exists user_book cascade;

drop table if exists user_category cascade;

drop table if exists user_feedback cascade;

drop table if exists user_rating cascade;

